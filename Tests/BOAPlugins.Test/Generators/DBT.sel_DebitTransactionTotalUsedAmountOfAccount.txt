/* KUWAIT TURKISH PARTICIPATION BANK INC.

    All rights are reserved. Reproduction or transmission in whole or in part, in
    any form or by any means, electronic, mechanical or otherwise, is prohibited
    without the prior written consent of the copyright owner.

    Generator Information
        Generated By  : Abdullah BEYAZTAŞ
        Purpose       : Selects used amount of account number for given @transactionDate.
*/
CREATE PROCEDURE	[DBT].sel_DebitTransactionTotalUsedAmountOfAccount
(
	@accountNumber                   INT = NULL,
	@externalTransactionCode  VARCHAR(4) = NULL,
	@transactionDate	   SMALLDATETIME = NULL
) 
AS 
BEGIN
	
	SELECT SUM(ISNULL(dt.BillingAmount,0))
	  FROM BOA.DBT.DebitTransaction dt WITH (NOLOCK)
	 WHERE dt.TransactionDate			>= @transactionDate
	   AND dt.ExternalResponseCode		 = '0'
	   AND dt.IsReversed				 = 0
	   AND dt.ExternalTransactionCode	 = @externalTransactionCode
	   AND dt.AccountNumber				 = @accountNumber
	   
END